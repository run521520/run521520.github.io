

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=dark>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/baimao.jpg">
  <link rel="icon" href="/img/baimao.jpg">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="youduck7">
  <meta name="keywords" content="">
  
    <meta name="description" content="学习视频是B站的作者是:mr_m0nst3r链接学习资源 这个博主写的也不错,可以看一下starrysky 安装的话就不说了，因为博主也是看着网上的安装的。 什么是符号执行：符号执行 （Symbolic Execution）是一种程序分析技术。可以通过分析程序来得到让特定代码区域执行的输入。使用符号执行分析一个程序时，该程序会使用符号值作为输入，而非一般执行程序时使用的具体值。在达到目标代码时，分">
<meta property="og:type" content="article">
<meta property="og:title" content="angr">
<meta property="og:url" content="http://run521520.github.io/2025/10/20/08_angr/index.html">
<meta property="og:site_name" content="run521">
<meta property="og:description" content="学习视频是B站的作者是:mr_m0nst3r链接学习资源 这个博主写的也不错,可以看一下starrysky 安装的话就不说了，因为博主也是看着网上的安装的。 什么是符号执行：符号执行 （Symbolic Execution）是一种程序分析技术。可以通过分析程序来得到让特定代码区域执行的输入。使用符号执行分析一个程序时，该程序会使用符号值作为输入，而非一般执行程序时使用的具体值。在达到目标代码时，分">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-10-20T11:37:41.000Z">
<meta property="article:modified_time" content="2025-10-25T05:18:23.022Z">
<meta property="article:author" content="youduck7">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>angr - run521</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"run521520.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":3},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 8.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 80vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>youduck7</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/R_C.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="angr"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-10-20 19:37" pubdate>
          2025年10月20日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          11k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          88 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
        <div class="scroll-down-bar">
          <i class="iconfont icon-arrowdown"></i>
        </div>
      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">angr</h1>
            
            
              <div class="markdown-body">
                
                <p>学习视频是B站的<br>作者是:mr_m0nst3r<br><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV167411o7WK/?vd_source=fd5cdb6d7f1c081069afc1d62787fbf8">链接</a><br><a target="_blank" rel="noopener" href="https://github.com/jakespringer/angr_ctf">学习资源</a></p>
<p>这个博主写的也不错,可以看一下<a target="_blank" rel="noopener" href="https://starrysky1004.github.io/2024/12/17/angr-xue-xi-yu-angr-ctf-ti-jie-chi-xu-geng-xin/angr-xue-xi-yu-angr-ctf-ti-jie-chi-xu-geng-xin/#toc-heading-16">starrysky</a></p>
<p>安装的话就不说了，因为博主也是看着网上的安装的。</p>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2><p>什么是符号执行：<br>符号执行 （Symbolic Execution）是一种程序分析技术。可以通过分析程序来得到让特定代码区域执行的输入。<br>使用符号执行分析一个程序时，该程序会使用符号值作为输入，而非一般执行程序时使用的具体值。<br>在达到目标代码时，分析器可以得到相应的路径约束，然后通过约束求解器来得到可以触发目标代码的具体值。<br>符号模拟技术（symbolic simulation）则把类似的思想用于硬件分析。<br>符号计算（Symbolic computation）则用于数学表达式分析。我理解为更厉害的爆破。<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_52369224/article/details/121319151">原文链接</a></p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>使用angr分析的大致流程：</p>
<ol>
<li>导入angr</li>
<li>导入二进制文件</li>
<li>创建程序入口点的状态(state)</li>
<li>将要求解的变量符号化,定义符号变量并与二进制文件相联系</li>
<li>建立simgr,用于管理state</li>
<li>通过.active的变化来找到满足我们要求的目标状态</li>
<li>求解程序执行行到state时,符号化变量所需的目标状态</li>
<li>解出约束条件,获取目标状态的数值</li>
</ol>
<h3 id="1-创建project对象"><a href="#1-创建project对象" class="headerlink" title="1. 创建project对象"></a>1. 创建project对象</h3><p>因为angr是一个基于符号执行和模拟执行的二进制框架,所以运行文件的二进制,你必须要有。<br>载入二进制文件使用<code>angr.Project函数</code>,它的第一个参数是载入文件的路径,后面还有其它参数<br>我没学。<br><code>p = angr.Project(&#39;/text&#39;)</code><br>project只是加载二进制文件，实际是对simstate对象操作<br>simstate对象是程序的状态，包含运行时的一切信息，例如寄存器、内存值、文件系统、符号变量。</p>
<hr>
<h3 id="2-设置state"><a href="#2-设置state" class="headerlink" title="2. 设置state"></a>2. 设置state</h3><p>创建项目之后,需要一个工厂来解决问题,创建一个状态，默认是程序的入口地址,<br>这个状态保存着程序运行到某一阶段的信息,且可以通过修改这一状态进而修改上下文的信息。</p>
<p><code>state = p.factory.entry_state()</code><br>也可以指定一个地址作为入口地址<br><code>state = p.factory.entry_state(addr=0x110110)</code><br>比如这里就指定0x110110作为入口地址,一般地址设为加密的函数入口。</p>
<ul>
<li><p>entry_state:做一些初始化工作，然后在程序的入口停下。<br>在创建完entry_state，之后就可以通过这个state对象，获取或者修改此时程序的运行状态。</p>
</li>
<li><p>state对象一般是符号执行开始前创建,用来初始化一些数据,或者是在路劲探索结束后,返回一个state<br>对象供用户提取需要的值,或进行约束求解.<br>创建完之后便是寻找路劲。程序当前的状态有多种表示。<br>**step()**表示向下执行一个block(42bytes)，**step()**函数产生active状态，<br>表示该分支在执行中。<br>**run()**表示运行到结束，**run()**函数产生deadended状态，表示分支结束。<br>**explore()**可以对地址进行限制以减少符号执行遍历的路径。**explore()**产生found状态<br>表示探索的结果等等。</p>
</li>
</ul>
<hr>
<h3 id="3-设置Simulation-Managers，进行路径探索的对象"><a href="#3-设置Simulation-Managers，进行路径探索的对象" class="headerlink" title="3. 设置Simulation Managers，进行路径探索的对象"></a>3. 设置Simulation Managers，进行路径探索的对象</h3><p>这个对象用于具体的路径探索<br><code>sm = p.factory.simulation_manager(state)</code><br>指定我们想要走到的位置：（使用explore执行模拟器，find和avoid用来作为约束条件）<br><code>res = sm.explore(find = 0x4005fb, avoid = 0x400607)</code><br>执行len(res.found)输出为1，可以知道found了一个结果,我们把找到的这个结果输出：<br><code>res.found[0].posix.dumps(0).strip(&quot;\x00&quot;)</code></p>
<hr>
<p>所以大致流程代码就是上面的了。</p>
<h2 id="使用模板"><a href="#使用模板" class="headerlink" title="使用模板"></a>使用模板</h2><h3 id="简单的一个模板"><a href="#简单的一个模板" class="headerlink" title="简单的一个模板:"></a><strong>简单的一个模板:</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr						<span class="hljs-comment">#导angr包</span><br><br>p = angr.Project(<span class="hljs-string">&#x27;/root&#x27;</span>)   	<span class="hljs-comment"># 创建项目,引入路劲,可以在路劲后面加上 auto_load_libs=False 关闭自动加载库提高性能</span><br>state = p.factory.entry_state() <span class="hljs-comment">#建工厂,就是初始化状态</span><br><br>sm = p.factory.simulation_manager(state)  <span class="hljs-comment">#创建模拟管理器</span><br>sm.explore(find=<span class="hljs-number">0x110110</span>)		<span class="hljs-comment">#探索路劲,find是成功分支地址,avoid是失败的地址</span><br><br>st = sm.found[<span class="hljs-number">0</span>]<br><br><span class="hljs-built_in">print</span>(st.posix.dumps(<span class="hljs-number">0</span>))<br><br></code></pre></td></tr></table></figure>

<p>当程序中出现多个 <code>Try again</code> 和 <code>Good job</code>,就不能再添目标地址了,<br>因为explore发现第一个成功就没了,所以针对这种情况,将这两种情况判断写<br>成函数作为<code>find</code>和<code>avoid</code>的参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">import</span> angr<br>project = angr.Project(<span class="hljs-string">&#x27;./text&#x27;</span>)<br>simgr = project.factory.simulation_manager()  <span class="hljs-comment">#这是允许的可以一步到位</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">right</span>(<span class="hljs-params">state</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">b&#x27;Good&#x27;</span> <span class="hljs-keyword">in</span> state.posix.dumps(<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">wrong</span>(<span class="hljs-params">state</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">b&#x27;Try&#x27;</span> <span class="hljs-keyword">in</span> state.posix.dumps(<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>simgr.explore(find=right, avoid=wrong)<br><br><span class="hljs-keyword">if</span> simgr.found:<br>    solution_state = simgr.found[<span class="hljs-number">0</span>]<br>    <span class="hljs-built_in">print</span>(solution_state.posix.dumps(<span class="hljs-number">0</span>))<br><br></code></pre></td></tr></table></figure>

<h3 id="绕过输入-操控寄存器"><a href="#绕过输入-操控寄存器" class="headerlink" title="绕过输入,操控寄存器"></a>绕过输入,操控寄存器</h3><p>就是angr的输入格式不是很好,所以为了不出现问题,不从输入入手,<br>因为输入的数据是存在寄存器中然后传递给栈,所以找到存储的寄存器就行了<br>从传递寄存器参数给栈的位置开始执行,避开输入。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs asm"><br>//输入数据<br><br>.text:08048937                 mov     ecx, [ebp+var_18]<br>.text:0804893A                 mov     eax, ecx<br>.text:0804893C                 mov     ecx, [ebp+var_14]<br>.text:0804893F                 mov     ebx, ecx<br>.text:08048941                 mov     ecx, [ebp+var_10]<br><br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs asm"><br>//传递给栈<br><br>.text:0804897B                 call    get_user_input<br>.text:08048980                 mov     [ebp+var_14], eax<br>.text:08048983                 mov     [ebp+var_10], ebx<br>.text:08048986                 mov     [ebp+var_C], edx<br><br></code></pre></td></tr></table></figure>

<p>这里讲一下,一些相关的函数(这里是按照顺序写的):</p>
<ul>
<li><p>entry_state() 从程序入口开始执行<br><code>entry_state = project.factory.entry_state()</code><br><code>project</code>是引入文件的设置的变量名。</p>
</li>
<li><p>blank_state() 从特殊位置开始<br><code>initial_state = project.factory.blank_state(addr=0x8048000)</code><br>就是用于绕过某些函数,和步骤之类的。</p>
</li>
<li><p>claripy.BVS(name,bit) 函数 用于创建位向量符号变量 就是一个变量<br>第一个参数变量名,第二个是字节数多少位。<br><code>arg1 = claripy.BVS(&#39;arg1&#39;, 32)</code></p>
</li>
<li><p>state.regs 后面根cpu寄存器,作用是访问和设置寄存器的值<br>支持的寄存器: <code>eax, ebx, ecx, edx, esi, edi, esp, ebp, eip等</code><br>主要用于符号化寄存器输入,模拟函数参数传递。<br>设置寄存器变量：<code>initial_state.regs.eax = arg1</code></p>
</li>
<li><p>simgr &#x3D; simulation_manager 模拟管理器<br>就是我们已经创建好了变量寄存器符号后,需要对它进行模拟(就是爆破的意思)<br>就是用 simgr来实现的 <code>simgr = simulation_manager</code>意思是说 它们两个写<br>哪一个都行,在要求较为准确的文档,或其它中是  <code>simulation_manager</code>，但是写脚本<br>之类的不严谨的时候 常用 <code>simgr</code>因为前者容易写错,后者好记。</p>
</li>
</ul>
<p><code>simgr = project.factory.simulation_manager(initial_state)</code></p>
<ul>
<li>simgr.explore(find,avoid) 自动探索执行路线，寻找目标状态<br>find和avoid的参数可以是目标地址,同时也可以是函数,当程序中成功后的提示<br>只调用一次时便可使用<code>目标地址</code>反而就用函数,为什么呢?我们的<code>目标地址</code>其实就是<br>成功的提示,当提示被调用多次时,那怎么办,所以用函数自定义来区分到底哪一个是正确的。</li>
</ul>
<p><code>目标地址</code>很好写,找到函数地址填上去就行了。<br><code>函数定义</code>下面就是一个例子:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-comment">#假设成功的提示有 Good 失败的有 Try</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">right</span>(<span class="hljs-params">state</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">b&#x27;Good&#x27;</span> <span class="hljs-keyword">in</span> state.posix.dumps(<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">wrong</span>(<span class="hljs-params">state</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">b&#x27;Try&#x27;</span> <span class="hljs-keyword">in</span> state.posix.dumps(<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br></code></pre></td></tr></table></figure>
<ol>
<li><code>state.posix</code> 	访问POSIX相关的抽象</li>
<li><code>dumps(num)</code> <ul>
<li>num &#x3D; 0 代表输入,就是flag</li>
<li>num &#x3D; 1 代表输出,就是提示</li>
<li>num &#x3D; 2 标准错误</li>
</ul>
</li>
<li><code>b&#39;Good&#39; in ...</code> 则是检查输出中是否含有字符串’Good’</li>
</ol>
<ul>
<li>simgr.found 存储成功的列表<br>专门来存储成功的信息的,我们从中取第一个信息,就是flag<br><code>solution = simgr.found[0]</code> 这时<code>solution</code>就包含flag了<br>正常的输入就直接打印了,但是如果不正常就是输入是十六十六进制的,需要转换一下</li>
</ul>
<p>从上文中我们模拟了一个 <code>eax</code> 寄存器的变量 <code>arg1</code> 所以要从 <code>solution</code>中取出来<br>用到了<code>solver.eval()</code></p>
<ul>
<li><code>solver.eval()</code> 求解符号表达式在当前状态下的具体值<br><code>arg = solution.solver.eval(arg1)</code><br><code>print(hex(arg))</code><br>这样子就行了</li>
</ul>
<hr>
<p>有一个练习题<br><a target="_blank" rel="noopener" href="https://github.com/jakespringer/angr_ctf/blob/master/dist/">03_angr_symbolic_registers</a></p>
<p>脚本是:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">import</span> angr<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> claripy<br><br>project = angr.Project(<span class="hljs-string">&#x27;./03_angr_symbolic_registers&#x27;</span>)<br>initial = project.factory.blank_state(addr=<span class="hljs-number">0x8048980</span>)<br><br>arg1 = claripy.BVS(<span class="hljs-string">&#x27;arg1&#x27;</span>, <span class="hljs-number">32</span>)<br>arg2 = claripy.BVS(<span class="hljs-string">&#x27;arg2&#x27;</span>, <span class="hljs-number">32</span>)<br>arg3 = claripy.BVS(<span class="hljs-string">&#x27;arg3&#x27;</span>, <span class="hljs-number">32</span>)<br><br>initial.regs.eax = arg1<br>initial.regs.ebx = arg2<br>initial.regs.edx = arg3<br><br>simgr = project.factory.simgr(initial)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">right</span>(<span class="hljs-params">state</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">b&#x27;Good&#x27;</span> <span class="hljs-keyword">in</span> state.posix.dumps(<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">wrong</span>(<span class="hljs-params">state</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">b&#x27;Try&#x27;</span> <span class="hljs-keyword">in</span> state.posix.dumps(<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>simgr.explore(find=right, avoid=wrong)<br><br><span class="hljs-keyword">if</span> simgr.found:<br>    solution = simgr.found[<span class="hljs-number">0</span>]<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(solution.solver.<span class="hljs-built_in">eval</span>(arg1)))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(solution.solver.<span class="hljs-built_in">eval</span>(arg2)))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(solution.solver.<span class="hljs-built_in">eval</span>(arg3)))<br><span class="hljs-comment">#0xb9ffd04e 0xccf63fe8 0x8fd4d959</span><br><br><br></code></pre></td></tr></table></figure>

<h3 id="绕过输入，操控栈"><a href="#绕过输入，操控栈" class="headerlink" title="绕过输入，操控栈"></a>绕过输入，操控栈</h3><p>就是我们还是和上面类似的情况，但是不能直接使用<strong>regs</strong>也就是说不能直接创建寄存器来符号化了。但是可以通过计算构造 <strong>esp</strong> 和 <strong>ebp</strong> 在合适的位置<strong>stack_push</strong>来入栈。<br>我们学汇编的时候都知道在进入一个函数的时候应该有以下的操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs asm">push    ebp<br>mov     ebp , esp<br>mov     esp , num    <br><br>//先把栈底ebp入栈，因为此时ebp还保存着上个函数的状态，先存着，然后就是创建一个新的&#x27;栈&#x27;，接着在栈顶开辟空间。<br></code></pre></td></tr></table></figure>


<p>所以虽然不可以直接创建寄存器和直接操作，但是可以将数据入栈来操作符号化。<br>这里的入栈是<code>state.stack_push()</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> claripy<br><br>project = angr.Project(<span class="hljs-string">&#x27;./04_angr_symbolic_stack&#x27;</span>)<br>initial_state = project.factory.blank_state(addr=<span class="hljs-number">0x8048697</span>)<br><br>arg1 = claripy.BVS(<span class="hljs-string">&#x27;arg1&#x27;</span>, <span class="hljs-number">32</span>)<br>arg2 = claripy.BVS(<span class="hljs-string">&#x27;arg2&#x27;</span>, <span class="hljs-number">32</span>)<br><br>initial_state.regs.esp = initial_state.regs.ebp<br>initial_state.regs.esp -= <span class="hljs-number">8</span><br><br>initial_state.stack_push(arg1)<br>initial_state.stack_push(arg2)<br><br>simgr = project.factory.simulation_manager(initial_state)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">right</span>(<span class="hljs-params">state</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">b&#x27;Good&#x27;</span> <span class="hljs-keyword">in</span> state.posix.dumps(<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">wrong</span>(<span class="hljs-params">state</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">b&#x27;Try&#x27;</span> <span class="hljs-keyword">in</span> state.posix.dumps(<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>simgr.explore(find=right, avoid=wrong)<br><br><span class="hljs-keyword">if</span> simgr.found:<br>    solution_state = simgr.found[<span class="hljs-number">0</span>]<br>    <span class="hljs-built_in">print</span>(solution_state.solver.<span class="hljs-built_in">eval</span>(arg1))<br>    <span class="hljs-built_in">print</span>(solution_state.solver.<span class="hljs-built_in">eval</span>(arg2))<br>    <br><span class="hljs-comment">#1704280884</span><br><span class="hljs-comment">#2382341151</span><br></code></pre></td></tr></table></figure>

<h3 id="绕过输入，操控全局变量"><a href="#绕过输入，操控全局变量" class="headerlink" title="绕过输入，操控全局变量"></a>绕过输入，操控全局变量</h3><p>这这应该很好判断了，当你看到接收的变量是全局变量的时候就可以用了。<br>用到一个函数 <code>state.memory.store(地址, 变量)</code>,<br><code>cast_to=bytes</code> 意思是按字节类型输出</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> claripy<br><br>project = angr.Project(<span class="hljs-string">&#x27;./05_angr_symbolic_memory&#x27;</span>)<br>initial_state = project.factory.blank_state(addr=<span class="hljs-number">0x8048601</span>)<br><br>arg1 = claripy.BVS(<span class="hljs-string">&#x27;arg1&#x27;</span>, <span class="hljs-number">64</span>)<br>arg2 = claripy.BVS(<span class="hljs-string">&#x27;arg2&#x27;</span>, <span class="hljs-number">64</span>)<br>arg3 = claripy.BVS(<span class="hljs-string">&#x27;arg3&#x27;</span>, <span class="hljs-number">64</span>)<br>arg4 = claripy.BVS(<span class="hljs-string">&#x27;arg4&#x27;</span>, <span class="hljs-number">64</span>)<br>addr = <span class="hljs-number">0xA1BA1C0</span> <br><br>initial_state.memory.store(addr, arg1)<br>initial_state.memory.store(addr + <span class="hljs-number">0x8</span>, arg2)<br>initial_state.memory.store(addr + <span class="hljs-number">0x10</span>, arg3)<br>initial_state.memory.store(addr + <span class="hljs-number">0x18</span>, arg4)<br><br>simgr = project.factory.simulation_manager(initial_state)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">right</span>(<span class="hljs-params">state</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">b&#x27;Good&#x27;</span> <span class="hljs-keyword">in</span> state.posix.dumps(<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">wrong</span>(<span class="hljs-params">state</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">b&#x27;Try&#x27;</span> <span class="hljs-keyword">in</span> state.posix.dumps(<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>simgr.explore(find=right, avoid=wrong)<br><br><span class="hljs-keyword">if</span> simgr.found:<br>    solution_state = simgr.found[<span class="hljs-number">0</span>]<br>    <span class="hljs-built_in">print</span>(solution_state.solver.<span class="hljs-built_in">eval</span>(arg1, cast_to=<span class="hljs-built_in">bytes</span>))<br>    <span class="hljs-built_in">print</span>(solution_state.solver.<span class="hljs-built_in">eval</span>(arg2, cast_to=<span class="hljs-built_in">bytes</span>))<br>    <span class="hljs-built_in">print</span>(solution_state.solver.<span class="hljs-built_in">eval</span>(arg3, cast_to=<span class="hljs-built_in">bytes</span>))<br>    <span class="hljs-built_in">print</span>(solution_state.solver.<span class="hljs-built_in">eval</span>(arg4, cast_to=<span class="hljs-built_in">bytes</span>))<br><span class="hljs-comment">#b&#x27;NAXTHGNR&#x27;</span><br><span class="hljs-comment">#b&#x27;JVSFTPWE&#x27;</span><br><span class="hljs-comment">#b&#x27;LMGAUHWC&#x27;</span><br><span class="hljs-comment">#b&#x27;XMDCPALU&#x27;</span><br></code></pre></td></tr></table></figure>
<h3 id="怎么判断是：寄存器、栈、全局变量"><a href="#怎么判断是：寄存器、栈、全局变量" class="headerlink" title="怎么判断是：寄存器、栈、全局变量"></a>怎么判断是：寄存器、栈、全局变量</h3><p>开始的时候我也是感觉不太好分辨，查了些资料有点头绪了。</p>
<ol>
<li>当输入的值直接给寄存器并用寄存器操作的时候就是用<strong>寄存器模板</strong>，比如：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs asm">.text:0804891E                 lea     ecx, [ebp+var_10]<br>.text:08048921                 push    ecx<br>.text:08048922                 lea     ecx, [ebp+var_14]<br>.text:08048925                 push    ecx<br>.text:08048926                 lea     ecx, [ebp+var_18]<br>.text:08048929                 push    ecx<br>.text:0804892A                 push    offset aXXX     ; &quot;%x %x %x&quot;<br>.text:0804892F                 call    ___isoc99_scanf<br>.text:08048934                 add     esp, 10h<br>.text:08048937                 mov     ecx, [ebp+var_18]<br>.text:0804893A                 mov     eax, ecx<br>.text:0804893C                 mov     ecx, [ebp+var_14]<br>.text:0804893F                 mov     ebx, ecx<br>.text:08048941                 mov     ecx, [ebp+var_10]<br>.text:08048944                 mov     edx, ecx<br>.text:08048946                 nop	<br></code></pre></td></tr></table></figure>
<p>可以好好看看先压入三个寄存器用来储存输入的值，在输入后又把值赋值给寄存器，看一下这里并没有把寄存器压入到栈中，这就是直接存储给寄存器。</p>
<ol start="2">
<li><p>讲一下<code>scanf</code>函数的储存，<code>scanf</code>输入的值刚开始是在栈上的，但是看上面，虽然开始是在栈上的，但是立即储存到寄存器中了，并且后续都是用寄存器计算。</p>
</li>
<li><p>当输入的值不是直接给寄存器，而是一直存储在栈中的就用<strong>栈模板</strong>，比如：</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs asm">.text:0804867F                 sub     esp, 4<br>.text:08048682                 lea     eax, [ebp+var_10]<br>.text:08048685                 push    eax<br>.text:08048686                 lea     eax, [ebp+var_C]<br>.text:08048689                 push    eax<br>.text:0804868A                 push    offset aUU      ; &quot;%u %u&quot;<br>.text:0804868F                 call    ___isoc99_scanf<br>.text:08048694                 add     esp, 10h<br>.text:08048697                 mov     eax, [ebp+var_C]<br>.text:0804869A                 sub     esp, 0Ch<br>.text:0804869D                 push    eax<br>.text:0804869E                 call    complex_function0<br>.text:080486A3                 add     esp, 10h<br>.text:080486A6                 mov     [ebp+var_C], eax<br>.text:080486A9                 mov     eax, [ebp+var_10]<br>.text:080486AC                 sub     esp, 0Ch<br>.text:080486AF                 push    eax<br>.text:080486B0                 call    complex_function1<br></code></pre></td></tr></table></figure>
<p>明显可以看到虽然在输入后把<code>[ebp+var_C]</code>的值给了<code>eax</code>并把寄存器押入到栈中了，这是因为其他函数在调用时，方便可以从栈中取出来使用，其次在后续中并没有用<code>eax</code>来取代<code>[ebp+var_C]</code>，也就是说值一直都在栈中，思想不就是用栈来操作吗。</p>
<ol start="4">
<li><strong>全局变量</strong>这个比较好判断，就是看接收的值是不是<strong>全局变量</strong>就行了。</li>
</ol>
<hr>
<pre><code class="hljs">情况                     方法                            要点
      
</code></pre>
<hr>
<p>返回值&#x2F;直接计算                    寄存器                        <code>regs.eax = arg1</code></p>
<hr>
<p>函数参数&#x2F;一直用内存计算       栈                              <code>stack_push(arg1)</code></p>
<hr>
<p>全局变量                               内存                            <code>memory.store(addres,name)</code></p>
<hr>
<h3 id="操控动态内存问题"><a href="#操控动态内存问题" class="headerlink" title="操控动态内存问题"></a>操控动态内存问题</h3><p>大意就是在输入的变量的内存为<code>malloc</code>动态分配的时候，程序静态的时候它是在堆栈中找不到的，只有在动态运行或调试的时候才会分配，其次分配的内存是不固定的，所以我们可以给他一个内存，然后就可以操作了，这里给的内存是用不到的内存</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs asm">内存地址空间：<br>0x00110110: 代码段 (text)<br>0x00220220: 数据段/BSS段 (存储全局变量)<br>0x00330330: 堆空间 (malloc分配在这里)<br></code></pre></td></tr></table></figure>
<p>其次在写脚本的时候，要在创建好<strong>门口</strong>的时候就创建变量的内存空间<br>就是在<code>malloc</code>之后，<code>scanf</code>之前开始执行<br><code>endness</code>设置端序</p>
<ul>
<li><code>endness = LE</code>小端序</li>
<li><code>endness = BE</code>大端序</li>
<li><code>endness = ME</code>中间序</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> claripy<br><br>p = angr.Project(<span class="hljs-string">&#x27;./06_angr_symbolic_dynamic_memory&#x27;</span>)<br>init = p.factory.blank_state(addr=<span class="hljs-number">0x8048699</span>)<br><span class="hljs-comment"># 创建符号变量</span><br>arg1 = claripy.BVS(<span class="hljs-string">&#x27;arg1&#x27;</span>,<span class="hljs-number">64</span>)<br>arg2 = claripy.BVS(<span class="hljs-string">&#x27;arg2&#x27;</span>,<span class="hljs-number">64</span>)<br><span class="hljs-comment"># 设置BSS段地址：储存堆指针的全局变量位置</span><br>add1 = <span class="hljs-number">0xABCC8A4</span>   <span class="hljs-comment"># buffer1指针本身的地址</span><br>add2 = <span class="hljs-number">0xABCC8AC</span>   <span class="hljs-comment"># buffer2指针本身的地址</span><br><span class="hljs-comment"># 自定义堆地址 不和程序原本的地址冲突就行</span><br>heap_ptr1 = <span class="hljs-number">0x12340</span>   <span class="hljs-comment"># 创建 buffer1指向这里的内存</span><br>heap_ptr2 = <span class="hljs-number">0x12350</span>   <span class="hljs-comment"># 创建 buffer2指向这里的内存</span><br><span class="hljs-comment"># 定义完后便是设置BSS段的指针值</span><br><span class="hljs-comment"># 表示 buffer1 指向 0x12340 ， 其次这里的 endness=&quot;LE&quot;告诉python这是以什么方式储存的,然后便是将符号变量的值存到内存中</span><br>init.memory.store(add1,heap_ptr1,endness=<span class="hljs-string">&quot;LE&quot;</span>)<br>init.memory.store(add2,heap_ptr2,endness=<span class="hljs-string">&quot;LE&quot;</span>)<br>init.memory.store(heap_ptr1,add1)<br>init.memory.store(heap_ptr2,add2)<br><span class="hljs-comment"># 然后便是创建符号管理器</span><br>simgr = p.factory.simgr(init)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">right</span>():<br>	...<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">wrong</span>():<br>	...<br>simgr.explore(find=right,avoid=wrong)<br><br><span class="hljs-keyword">if</span> simgr.found:<br>	s = simgr.found[<span class="hljs-number">0</span>]<br>	<span class="hljs-built_in">print</span>(s.solver.<span class="hljs-built_in">eval</span>(arg1,cast_to=<span class="hljs-built_in">bytes</span>))<br>	<span class="hljs-built_in">print</span>(s.solver.<span class="hljs-built_in">eval</span>(arg2,cast_to=<span class="hljs-built_in">bytes</span>))<br><br></code></pre></td></tr></table></figure>

<p>执行后的内存大概是这样子的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs asm">BSS段 (全局变量区):<br>地址 0xABCC8A4: 0x00012340  ← 我们说buffer1指向0x12340<br>地址 0xABCC8AC: 0x00012350  ← 我们说buffer2指向0x12350<br><br>&quot;堆&quot;区域 (我们伪造的):<br>地址 0x12340: 符号数据arg1  ← 实际存储第一个输入的地方<br>地址 0x12350: 符号数据arg2  ← 实际存储第二个输入的地方<br></code></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>题型</th>
<th>数据在哪</th>
<th>解决方法</th>
</tr>
</thead>
<tbody><tr>
<td>寄存器</td>
<td>寄存器中</td>
<td><code>regs.eax = 符号</code></td>
</tr>
<tr>
<td>栈参数</td>
<td>栈空间中</td>
<td><code>stack_push(符号)</code></td>
</tr>
<tr>
<td>静态内存</td>
<td>固定地址</td>
<td><code>store(固定地址, 符号)</code></td>
</tr>
<tr>
<td>动态内存</td>
<td>指针→堆</td>
<td><code>store(指针地址, 堆地址)</code> + <code>store(堆地址, 符号)</code></td>
</tr>
</tbody></table>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>angr</div>
      <div>http://run521520.github.io/2025/10/20/08_angr/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>youduck7</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年10月20日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/10/17/07_mybook/" title="一些做题的经验或心得">
                        <span class="hidden-mobile">一些做题的经验或心得</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"WCiAJOcmEvtC8mCKY347mmNi-MdYXbMMI","appKey":"Ds56gTbsyMSf1AJROtxNZAai","path":"window.location.pathname","placeholder":null,"avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"https://wciajocm.api.lncldglobal.com","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
